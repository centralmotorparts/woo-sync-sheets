name: Woo Sync (Sheets)

on:
  workflow_dispatch: {}
  schedule:
    - cron: "5 2 * * *"   # dagelijks 02:05 UTC

jobs:
  run-sync:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Check out
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # ❗ Schrijft de Google Service Account JSON naar een bestand dat het script leest
      - name: Write Google credentials file
        shell: bash
        run: |
          printf '%s' '${{ secrets.GOOGLE_CREDENTIALS_JSON }}' > "$GITHUB_WORKSPACE/creds.json"

      - name: Run sync
        env:
          GOOGLE_APPLICATION_CREDENTIALS: ${{ github.workspace }}/creds.json
          SUPPLIER_CSV_URL: ${{ secrets.SUPPLIER_CSV_URL }}
          WOO_BASE_URL: ${{ secrets.WOO_BASE_URL }}
          WOO_KEY: ${{ secrets.WOO_KEY }}
          WOO_SECRET: ${{ secrets.WOO_SECRET }}
          SHEET_ID: ${{ secrets.SHEET_ID }}
          BATCH_SLEEP: "0.10"
        run: |
          python sync_catalog_sheets.py
